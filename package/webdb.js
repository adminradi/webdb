/* WebDB v1.2.1 - 3/28/2014
   http://github.com/haas85/webdb
   Copyright (c) 2014 IÃ±igo Gonzalez Vazquez <ingonza85@gmail.com> (@haas85) - Under MIT License */
(function(){var a,b,c,d,e,f;window.indexedDB=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB;c=function(){b.prototype.db=null;function b(b,c,d,e,f){var g;this.name=b;this.schema=c;this.version=d;this.size=e!=null?e:5242880;if(window.indexedDB){g=new a.indexedDB(this.name,this.schema,this.version,f)}else if(window.openDatabase){g=new a.webSQL(this.name,this.schema,this.version,this.size,f)}if(!window.openDatabase&&!window.indexedDB){this.select=function(a,b,c){if(c!=null){return c.call(c,"HTML5 Databases not supported",null)}};this.insert=function(a,b,c){if(c!=null){return c.call(c,"HTML5 Databases not supported",null)}};this.update=function(a,b,c,d){if(c==null){c=[]}if(d!=null){return d.call(d,"HTML5 Databases not supported",null)}};this["delete"]=function(a,b,c){if(c!=null){return c.call(c,"HTML5 Databases not supported",null)}};this.drop=function(a,b){if(b!=null){return b.call(b,"HTML5 Databases not supported",null)}};this.execute=function(a,b){if(b!=null){return b.call(b,"HTML5 Databases not supported",null)}}}else{this.db=g.db;this.select=function(){return g.select.apply(g,arguments)};this.insert=function(){return g.insert.apply(g,arguments)};this.update=function(){return g.update.apply(g,arguments)};this["delete"]=function(){return g["delete"].apply(g,arguments)};this.drop=function(){return g.drop.apply(g,arguments)};this.execute=function(){return g.execute.apply(g,arguments)}}}return b}();a=window.WebDB=c;e=function(a,b){var c,d;d=[];for(c in b){d.push(a[c]=b[c])}return d};f=function(a){return Object.prototype.toString.call(a).match(/[a-zA-Z] ([a-zA-Z]+)/)[1].toLowerCase()};b=function(){var a,b,c;d.prototype.db=null;d.prototype.version=0;d.prototype.schema="";d.prototype.name="";d.prototype.VERSION_KEY="indexedDB_version";d.prototype.SCHEMA_KEY="indexedDB_schema";function d(a,b,c,d){var e,g;if(c==null){c=1}if(!window.indexedDB&&d!=null){return d.call(d,"IndexedDB not supported",null)}this.VERSION_KEY+="_"+a;this.SCHEMA_KEY+="_"+a;this.version=parseInt(localStorage[this.VERSION_KEY]);if(this.version==null||this.version<c||isNaN(this.version)){localStorage[this.VERSION_KEY]=this.version=parseInt(c)}this.schema=localStorage[this.SCHEMA_KEY];g=JSON.stringify(b);if(this.schema!=null&&this.schema!==g){localStorage[this.SCHEMA_KEY]=this.schema=g;localStorage[this.VERSION_KEY]=this.version+=1}else{localStorage[this.SCHEMA_KEY]=this.schema=g}this.name=a;e=window.indexedDB.open(a,this.version);e.onsuccess=function(a){return function(b){a.db=b.target.result;if(d!=null){return d.call(d,null,a.db)}}}(this);e.onerror=function(a){if(d!=null){return d.call(d,a,null)}};e.onupgradeneeded=function(a){return function(c){var d,e,g,h;a.db=c.target.result;h=[];for(g in b){e={};for(d in b[g]){if(f(b[g][d])==="object"){if(b[g][d]["primary"]){e["keyPath"]=d}if(b[g][d]["autoincrement"]){e["autoIncrement"]=true}}}if(e.keyPath==null){e={keyPath:"__key",autoIncrement:true}}if(!a.db.objectStoreNames.contains(g)){h.push(a.db.createObjectStore(g,e))}else{h.push(void 0)}}return h}}(this);e.onversionchange=function(a){return console.log(a)}}d.prototype.select=function(a,c,d){if(c==null){c=[]}return b(this.db,a,null,c,d)};d.prototype.insert=function(a,b,d){var e,g,h,i,j,k,l;if(f(b)==="object"){return c(this,a,b,d)}else{e=b.length;k=0;h=[];l=[];for(i=0,j=b.length;i<j;i++){g=b[i];l.push(c(this,a,g,function(a,b){if(a==null){k++}if(a!=null){h.push(a)}e--;if(e===0&&d!=null){if(h.length===0){h=null}return d.call(d,h,k)}}))}return l}};d.prototype.update=function(a,c,d,e){if(d==null){d=[]}return b(this.db,a,c,d,function(a,b){if(e!=null){return e.call(e,a,b.length)}})};d.prototype["delete"]=function(b,c,d){var e,f,g,h;if(c==null){c=[]}try{f=0;g=this.db.transaction([b],"readwrite").objectStore(b);h=g.openCursor();h.onsuccess=function(b){var e,h;e=b.target.result;if(e){h=e.value;if(a(h,c)){f++;g["delete"](e.primaryKey)}return e["continue"]()}else{if(d!=null){return d.call(d,null,f)}}};return h.onerror=function(a){if(d!=null){return d.call(d,a,null)}}}catch(i){e=i;if(d!=null){return d.call(d,e,null)}}};d.prototype.drop=function(a,b){var c,d;try{this.db.close();this.version+=1;localStorage[this.VERSION_KEY]=this.version;d=window.indexedDB.open(this.name,this.version);d.onsuccess=function(a){return function(b){return a.db=b.target.result}}(this);d.onupgradeneeded=function(c){return function(d){var e;c.db=d.target.result;c.db.deleteObjectStore(a);e=JSON.parse(c.schema);delete e[a];c.schema=localStorage[c.SCHEMA_KEY]=JSON.stringify(e);if(b!=null){return b.call(b,null)}}}(this);return d.onerror=function(a){if(b!=null){return b.call(b,a)}}}catch(e){c=e;if(b!=null){return b.call(b,c)}}};d.prototype.execute=function(a,b){if(b!=null){return b.call(b,"Execute not supported")}};c=function(a,b,c,d){var e,f;f=a.db.transaction([b],"readwrite").objectStore(b);e=f.add(c);e.onerror=function(a){if(d!=null){return d.call(d,a,null)}};return e.onsuccess=function(a){if(d!=null){return d.call(d,null,1)}}};a=function(a,b){var c,d,e,f,g;if(b==null){b=[]}if(b.length===0){return true}for(f=0,g=b.length;f<g;f++){e=b[f];d=true;for(c in e){if(a[c]!==e[c]){d=false;break}}if(d===true){return true}}return false};b=function(b,c,d,f,g){var h,i,j;if(f==null){f=[]}i=[];h=d!=null?"readwrite":"readonly";j=b.transaction([c],h).objectStore(c).openCursor();j.onsuccess=function(b){var c,h;c=b.target.result;if(c){h=c.value;if(a(h,f)){if(d!=null){e(h,d);e(c.value,d);c.update(c.value)}i.push(h)}return c["continue"]()}else{if(g!=null){return g.call(g,null,i)}}};return j.onerror=function(a){if(g!=null){return g.call(g,a,null)}}};return d}();a.indexedDB=b;d=function(){var a,b,c,d,e;g.prototype.db=null;c={};e=null;function g(a,b,d,g,h){var i,j,k,l;if(g==null){g=5}if(h!=null&&!window.openDatabase){return h.call(h,"WebSQL not supported",null)}g=g*1024*1024;this.db=window.openDatabase(a,d,"",g);l=0;for(k in b){c[k]={};j="CREATE TABLE IF NOT EXISTS "+k+" (";for(i in b[k]){if(f(b[k][i])==="object"){if(b[k][i]["autoincrement"]){j+="'"+i+"' INTEGER"}else{j+="'"+i+"' "+b[k][i]["type"]}if(b[k][i]["primary"]){j+=" PRIMARY KEY"}if(b[k][i]["autoincrement"]){j+=" AUTOINCREMENT"}j+=",";c[k][i]=b[k][i]["type"]}else{j+="'"+i+"' "+b[k][i]+",";c[k][i]=b[k][i]}}j=j.substring(0,j.length-1)+")";l++;e=this;this.execute(j,function(a){return function(b,c){l--;if(l===0&&h!=null){return h.call(h,b,a.db)}}}(this))}}g.prototype.select=function(a,c,d){var e,f;if(c==null){c=[]}try{f="SELECT * FROM "+a+b(a,c);return this.execute(f,d)}catch(g){e=g;if(d!=null){return d.call(d,e,null)}}};g.prototype.insert=function(b,c,d){var e,g,h,i,j,k,l;if(f(c)==="object"){return a(b,c,d)}else{e=c.length;g=0;i=[];l=[];for(j=0,k=c.length;j<k;j++){h=c[j];l.push(a(b,h,function(a,b){if(a!=null){i.push(a)}e--;if(a==null){g++}if(e===0&&d!=null){if(i.length===0){i=null}return d.call(d,i,g)}}))}return l}};g.prototype.update=function(a,c,e,f){var g,h,i;if(e==null){e=[]}try{i="UPDATE "+a+" SET ";for(h in c){i+=""+h+" = "+d(a,h,c[h])+", "}i=i.substring(0,i.length-2)+b(a,e);return this.execute(i,f)}catch(j){g=j;if(f!=null){return f.call(f,g,null)}}};g.prototype["delete"]=function(a,c,d){var e,f;if(c==null){c=[]}try{f="DELETE FROM "+a+" "+b(a,c);return this.execute(f,d)}catch(g){e=g;if(d!=null){return d.call(d,e,null)}}};g.prototype.drop=function(a,b){return this.execute("DROP TABLE IF EXISTS "+a,function(a,c){if(b!=null){return b.call(b,a)}})};g.prototype.execute=function(a,b){if(!this.db&&b!=null){return b.call(b,"Database not initializated",null)}else{return this.db.transaction(function(c){return c.executeSql(a,[],function(c,d){var e,f;f=[];if(a.indexOf("SELECT")!==-1){f=function(){var a,b,c;c=[];for(e=a=0,b=d.rows.length;0<=b?a<b:a>b;e=0<=b?++a:--a){c.push(d.rows.item(e))}return c}();if(b!=null){return b.call(b,null,f)}}else{if(b!=null){return b.call(b,null,d.rowsAffected)}}},function(){if(b!=null){return b.call(b,arguments[1],null)}})})}};a=function(a,b,c){var f,g,h,i;try{i="INSERT INTO "+a+" (";f="(";for(h in b){i+=""+h+", ";f+=""+d(a,h,b[h])+", "}i=i.substring(0,i.length-2)+") ";f=f.substring(0,f.length-2)+") ";i+=" VALUES "+f;return e.execute(i,c)}catch(j){g=j;if(c!=null){return c.call(c,g,null)}}};b=function(a,b){var c,e,f,g,h,i;if(b.length>0){f=" WHERE (";for(h=0,i=b.length;h<i;h++){c=b[h];for(e in c){g=c[e];f+=""+e+" = "+d(a,e,g)+" AND "}f=f.substring(0,f.length-5)+") OR ("}return f.substring(0,f.length-5)}else{return""}};d=function(a,b,d){if(c[a][b]==="NUMBER"){return d}else{return"'"+d+"'"}};return g}();a.webSQL=d}).call(this);